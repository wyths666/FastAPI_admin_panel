from aiogram import Router, F
from aiogram.types import Message, CallbackQuery
from aiogram.filters import CommandStart, Command

from bot1.templates.user.keyboards import product_reaction_kb
from utils.database import get_database_bot1

router = Router()


@router.message(CommandStart())
async def cmd_start_with_product(message: Message):
    # –ü–æ–ª—É—á–∞–µ–º –∞—Ä–≥—É–º–µ–Ω—Ç—ã –ø–æ—Å–ª–µ /start
    args = message.text.split()

    if len(args) > 1 and args[1].isdigit():
        # –ï—Å–ª–∏ –ø–µ—Ä–µ–¥–∞–Ω ID —Ç–æ–≤–∞—Ä–∞
        product_id = int(args[1])
        await show_product_to_user(message, product_id)
    else:
        # –û–±—ã—á–Ω—ã–π —Å—Ç–∞—Ä—Ç
        await show_default_start(message)


async def show_product_to_user(message: Message, product_id: int):
    try:
        db = get_database_bot1()
        products_collection = db["products"]

        # –ò—â–µ–º —Ç–æ–≤–∞—Ä –ø–æ ID
        product = await products_collection.find_one({"id": product_id})

        if not product:
            await message.answer("‚ùå –¢–æ–≤–∞—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω")
            return

        # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∫–∞—Ä—Ç–æ—á–∫—É —Ç–æ–≤–∞—Ä–∞ —Å –∫–Ω–æ–ø–∫–∞–º–∏
        await message.answer_photo(
            photo=product['image_id'],
            caption=f"üõçÔ∏è <b>{product['title']}</b>\n\n"
                    f"{product['desc']}\n\n",
            parse_mode="HTML",
            reply_markup=product_reaction_kb()
        )

    except Exception as e:
        await message.answer("‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Ç–æ–≤–∞—Ä–∞")


async def show_default_start(message: Message):
    # —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —Å—Ç–∞—Ä—Ç–æ–≤—ã–π —Ç–µ–∫—Å—Ç
    await message.answer(
        '''üî•–ß–∞—Ç-–±–æ—Ç 100% –∫—ç—à-–±–µ–∫ –∑–∞ –æ—Ç–∑—ã–≤.üí∞  

‚ö†Ô∏è–ó–∞–∫–∞–∑ —Ç–æ–≤–∞—Ä–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –æ—Å—É—â–µ—Å—Ç–≤–ª—è—Ç—å —Ç–æ–ª—å–∫–æ –ø–æ –ø–µ—Ä–µ—Ö–æ–¥—É –ø–æ –∞–∫—Ç—É–∞–ª—å–Ω–æ–π —Å—Å—ã–ª–∫–µ. ‚ùóÔ∏è –ü—Ä–∏ —Å–ª—É—á–∞–π–Ω–æ–º –ø–µ—Ä–µ—Ö–æ–¥–µ –ø–æ –Ω–µ–∞–∫—Ç—É–∞–ª—å–Ω–æ–π —Å—Å—ã–ª–∫–µ, —É—Ç–æ—á–Ω–∏—Ç–µ —É –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞ —É—á–∞—Å—Ç–≤—É–µ—Ç –ª–∏ –¥–∞–Ω–Ω—ã–π —Ç–æ–≤–∞—Ä –≤ –Ω–∞—Å—Ç–æ—è—â–∏–π –º–æ–º–µ–Ω—Ç –≤ –≤—ã–∫—É–ø–µ –∑–∞ –∫—ç—à.

‚ö†Ô∏è–ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–ª–∏ –∫–∞–∫–∏–µ-—Ç–æ —Ç—Ä—É–¥–Ω–æ—Å—Ç–∏ –∏–ª–∏ –≤–æ–ø—Ä–æ—Å—ã –≤—ã –º–æ–∂–µ—Ç–µ –Ω–∞–ø–∏—Å–∞—Ç—å –æ–ø–µ—Ä–∞—Ç–æ—Ä—É"‚òëÔ∏è
  
‚ö†Ô∏è–û–ø–µ—Ä–∞—Ç–æ—Ä –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤—Å–µ –∑–∞–ø—Ä–æ—Å—ã –≤ —Ç–µ—á–µ–Ω–∏–∏ –¥–Ω—è, –¥–æ–∂–¥–∏—Ç–µ—Å—å –æ—Ç–≤–µ—Ç–∞.üôå. –í —Å–ª—É—á–∞–µ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è –æ—Ç–≤–µ—Ç–∞ –±–æ–ª–µ–µ 3-—Ö –¥–Ω–µ–π –ø—Ä–æ–¥—É–±–ª–∏—Ä—É–π—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ (–≤–æ–∑–º–æ–∂–Ω–æ –æ–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ –Ω–µ–ø–æ–¥—Ö–æ–¥—è—â–µ–º —Ñ–æ—Ä–º–∞—Ç–µ –∏ –æ–ø–µ—Ä–∞—Ç–æ—Ä –ø—Ä–æ—Å—Ç–æ –µ–≥–æ –Ω–µ –ø–æ–ª—É—á–∏–ª). –°—É–±–±–æ—Ç–∞ –∏ –≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ –≤—ã—Ö–æ–¥–Ω—ã–µ –¥–Ω–∏, –≤—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞ –º–æ–∂–µ—Ç –±—ã—Ç—å —É–≤–µ–ª–∏—á–µ–Ω–æ. –ù–∞–¥–µ–µ–º—Å—è –Ω–∞ –≤–∞—à–µ –ø–æ–Ω–∏–º–∞–Ω–∏–µ. ü§ù
–°–ø–∞—Å–∏–±–æ –∑–∞ –∏–Ω—Ç–µ—Ä–µ—Å –∫ –Ω–∞—à–µ–º—É –±—Ä–µ–Ω–¥—É.‚ù§Ô∏è'''
    )


@router.callback_query(F.data == "product_ready")
async def product_ready(call: CallbackQuery):
    await call.message.edit_caption(
        caption='''–ë–ª–∞–≥–æ–¥–∞—Ä–∏–º –∑–∞ –∑–∞–∫–∞–∑! üëç –ë—É–¥–µ–º –æ–∂–∏–¥–∞—Ç—å –ø–æ–ª—É—á–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞ –≤–º–µ—Å—Ç–µ —Å –≤–∞–º–∏. –ü—Ä–∏—Å—ã–ª–∞–π—Ç–µ –æ—Ç–∑—ã–≤ –Ω–∞ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ 2-3 –¥–Ω—è –ø–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è (–æ—Ç–∑—ã–≤ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤–æ—Å—Ç–æ—Ä–∂–µ–Ω–Ω—ã–π, —Å–æ–¥–µ—Ä–∂–∞—Ç—å 2-3 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –ø—Ä–æ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø—Ä–µ–ø–∞—Ä–∞—Ç–∞) —Å —Ñ–æ—Ç–æ

–û—Å—Ç–∞–µ–º—Å—è –Ω–∞ —Å–≤—è–∑–∏! üìû –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –Ω–µ –∑–∞–≤–µ—Ä—à–∞–π—Ç–µ –∏ –Ω–µ —É–¥–∞–ª—è–π—Ç–µ –¥–∞–Ω–Ω—ã–π —á–∞—Ç''',
        reply_markup=None
    )
    await call.answer()


# –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–Ω–æ–ø–∫–∏ "–ù–µ—Ç üëé"
@router.callback_query(F.data == "product_not_ready")
async def product_not_ready(call: CallbackQuery):
    # –£–¥–∞–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ —Å —Ç–æ–≤–∞—Ä–æ–º
    await call.message.delete()

    # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —Å—Ç–∞—Ä—Ç–æ–≤—ã–π —Ç–µ–∫—Å—Ç
    await call.message.answer(
        '''üî•–ß–∞—Ç-–±–æ—Ç 100% –∫—ç—à-–±–µ–∫ –∑–∞ –æ—Ç–∑—ã–≤.üí∞  

‚ö†Ô∏è–ó–∞–∫–∞–∑ —Ç–æ–≤–∞—Ä–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –æ—Å—É—â–µ—Å—Ç–≤–ª—è—Ç—å —Ç–æ–ª—å–∫–æ –ø–æ –ø–µ—Ä–µ—Ö–æ–¥—É –ø–æ –∞–∫—Ç—É–∞–ª—å–Ω–æ–π —Å—Å—ã–ª–∫–µ. ‚ùóÔ∏è –ü—Ä–∏ —Å–ª—É—á–∞–π–Ω–æ–º –ø–µ—Ä–µ—Ö–æ–¥–µ –ø–æ –Ω–µ–∞–∫—Ç—É–∞–ª—å–Ω–æ–π —Å—Å—ã–ª–∫–µ, —É—Ç–æ—á–Ω–∏—Ç–µ —É –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞ —É—á–∞—Å—Ç–≤—É–µ—Ç –ª–∏ –¥–∞–Ω–Ω—ã–π —Ç–æ–≤–∞—Ä –≤ –Ω–∞—Å—Ç–æ—è—â–∏–π –º–æ–º–µ–Ω—Ç –≤ –≤—ã–∫—É–ø–µ –∑–∞ –∫—ç—à.

‚ö†Ô∏è–ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–ª–∏ –∫–∞–∫–∏–µ-—Ç–æ —Ç—Ä—É–¥–Ω–æ—Å—Ç–∏ –∏–ª–∏ –≤–æ–ø—Ä–æ—Å—ã –≤—ã –º–æ–∂–µ—Ç–µ –Ω–∞–ø–∏—Å–∞—Ç—å –æ–ø–µ—Ä–∞—Ç–æ—Ä—É"‚òëÔ∏è
  
‚ö†Ô∏è–û–ø–µ—Ä–∞—Ç–æ—Ä –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤—Å–µ –∑–∞–ø—Ä–æ—Å—ã –≤ —Ç–µ—á–µ–Ω–∏–∏ –¥–Ω—è, –¥–æ–∂–¥–∏—Ç–µ—Å—å –æ—Ç–≤–µ—Ç–∞.üôå. –í —Å–ª—É—á–∞–µ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è –æ—Ç–≤–µ—Ç–∞ –±–æ–ª–µ–µ 3-—Ö –¥–Ω–µ–π –ø—Ä–æ–¥—É–±–ª–∏—Ä—É–π—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ (–≤–æ–∑–º–æ–∂–Ω–æ –æ–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ –Ω–µ–ø–æ–¥—Ö–æ–¥—è—â–µ–º —Ñ–æ—Ä–º–∞—Ç–µ –∏ –æ–ø–µ—Ä–∞—Ç–æ—Ä –ø—Ä–æ—Å—Ç–æ –µ–≥–æ –Ω–µ –ø–æ–ª—É—á–∏–ª). –°—É–±–±–æ—Ç–∞ –∏ –≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ –≤—ã—Ö–æ–¥–Ω—ã–µ –¥–Ω–∏, –≤—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞ –º–æ–∂–µ—Ç –±—ã—Ç—å —É–≤–µ–ª–∏—á–µ–Ω–æ. –ù–∞–¥–µ–µ–º—Å—è –Ω–∞ –≤–∞—à–µ –ø–æ–Ω–∏–º–∞–Ω–∏–µ. ü§ù
–°–ø–∞—Å–∏–±–æ –∑–∞ –∏–Ω—Ç–µ—Ä–µ—Å –∫ –Ω–∞—à–µ–º—É –±—Ä–µ–Ω–¥—É.‚ù§Ô∏è'''
    )
    await call.answer()

